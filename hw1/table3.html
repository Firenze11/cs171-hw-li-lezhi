<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
  <body>
      <div id="multiple_select">
          <strong>Filter:</strong>
          <label><input type="checkbox" name="Americas" value="1" id="Americas" />Americas</label>
          <label><input type="checkbox" name="Africa" value="1" id="Africa" />Africa</label>
          <label><input type="checkbox" name="Asia" value="1" id="Asia" />Asia</label>
          <label><input type="checkbox" name="Europe" value="1" id="Europe" />Europe</label>
          <label><input type="checkbox" name="Oceania" value="1" id="Europe" />Oceania</label>
      </div>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        //var json;
        
        var columnAscend = [false,false,false,false,false,false,false,false,false,];
///////////////////////////////////////////////////////////////////////////////////////////////load data->
      d3.json("data/countries_2012.json", function(error, data){
          var json = data;

          var columns = Object.keys(data[0]);
          //console.log(json);

          var table = d3.select("body").append("table"),
            thead = table.append("thead")
                       .attr("class", "thead");
          tbody = table.append("tbody");

        table.append("caption")
          .html("World Countries Ranking xxxxxx");

        thead.append("tr").selectAll("th")
          .data(columns)
        .enter()
          .append("th")
          .text(function (d) { return d; })
            .attr("ascend_descend","descend")

            ////////////////////////////////////////////////////////////////////////////////click sorting->
          .on("click", function (header, i) {
              columnAscend[i] = ! columnAscend[i];
                if (columnAscend[i] == false) {
                    var sorted_rows = tbody.selectAll("tr").sort(function (a, b) {
                    return d3.descending(a[header], b[header]);
                });
              }
              else {
                  var sorted_rows = tbody.selectAll("tr").sort(function (a, b) {
                      return d3.ascending(a[header], b[header]);
                  });
              }
           /////////////////////////////////////////////////////////////////////////////////update style->   
              sorted_rows.style("background-color", function (d, i) {
                  //console.log(d, i);
                  if (i % 2 == 0)
                      return "#FFCFCF";
                  else
                      return "white";
              })
            .on("mouseover", function () {
                d3.select(this).style("background-color", "#FF6699")
            })
            .on("mouseleave", function (d, i) {
            //console.log(i);
            d3.select(this).style("background-color", function () {
               if (i % 2 == 0)
                   return "#FFCFCF";
               else
                   return "white";
           })
       })
          });
        var continents_selected =[];
        d3.selectAll("#multiple_select input").on("change", function () {
            continents_selected = d3.selectAll("#multiple_select input")
                .filter(function () { return d3.select(this).property('checked') == true; })[0]
            //console.log(continents_selected);
                .map(function (e) {
                    console.log(e);
                    return d3.select(e).attr("name");
                });
            console.log(continents_selected);
        });
         
      //////////////////////////////////////////////////////////////////////////////enter rows->
        var rows = tbody.selectAll("tr.row")
        .data(json)
        .enter()
        .append("tr").attr("class", "row")
        .style("background-color", function (d, i) {
            //console.log(d, i);
            if (i % 2 == 0)
                return "#FFCFCF";
            else
                return "white";
        })
        .on("mouseover", function () {
            d3.select(this).style("background-color", "#FF6699")
        })
        .on("mouseleave", function (d, i) {
            //console.log(i);
            d3.select(this).style("background-color", function () {
                if (i % 2 == 0)
                    return "#FFCFCF";
                else
                    return "white";
            })
        });

        var cells = rows.selectAll("td")
          .data(function (row) {
              return d3.range(Object.keys(row).length).map(function (column, i) {
                  return row[Object.keys(row)[i]];
              });
          })
          .enter()
          .append("td")
          .text(function (d) { return d; });

          //////////////////////////////////////////////////////////////////update rows->
        function update(some_data) {
            tbody.selectAll("tr.row").remove();
            var update_rows = tbody.selectAll("tr.row")
              .data(some_data)
                .enter()
                .append("tr").attr("class", "row")
              .style("background-color", function (d, i) {
                  if (i % 2 == 0)
                      return "#FFCFCF";
                  else
                      return "white";
              })
              .on("mouseover", function () {
                  d3.select(this).style("background-color", "#FF6699")
              })
              .on("mouseleave", function (d, i) {
                  //console.log(i);
                  d3.select(this).style("background-color", function () {
                      if (i % 2 == 0)
                          return "#FFCFCF";
                      else
                          return "white";
                  })
              });
            console.log(update_rows.length);

            var cells = update_rows.selectAll("td")
              .data(function (row) {
                  return d3.range(Object.keys(row).length).map(function (column, i) {
                      return row[Object.keys(row)[i]];
                  });
              })
              .enter()
              .append("td")
              .text(function (d) { return d; });
            //console.log()
            }
        //update(data);
       });
    </script> 
  </body>
</html>